{% extends "base.html" %}

{% block title %}Users - SpendSense{% endblock %}

{% block content %}
<div class="user-detail">
    <div class="user-header">
        <h2>User List</h2>
    </div>
    
    <!-- Filters Section -->
    <section class="section">
        <h3>Filters</h3>
        <form method="get" action="/users" class="filter-form">
            <div class="form-group">
                <label for="search">Search:</label>
                <input type="text" id="search" name="search" value="{{ search }}" placeholder="User ID or name">
            </div>
            
            <div class="form-group">
                <label for="persona_filter">Persona:</label>
                <select id="persona_filter" name="persona_filter">
                    <option value="">All</option>
                    {% for persona_id, persona_name in persona_names.items() %}
                    <option value="{{ persona_id }}" {% if persona_filter == persona_id %}selected{% endif %}>{{ persona_name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="consent_filter">Consent:</label>
                <select id="consent_filter" name="consent_filter">
                    <option value="all" {% if consent_filter == "all" %}selected{% endif %}>All</option>
                    <option value="true" {% if consent_filter == "true" %}selected{% endif %}>Consented</option>
                    <option value="false" {% if consent_filter == "false" %}selected{% endif %}>Not Consented</option>
                </select>
            </div>
            
            <button type="submit" class="btn btn-primary">Filter</button>
            <a href="/users" class="btn btn-secondary">Clear</a>
        </form>
    </section>
    
    <!-- Users Table Section -->
    <section class="section">
        <h3>Users</h3>
        <div class="user-table-container">
            <table class="user-table">
                <thead>
                    <tr>
                        <th>User ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Persona (30d)</th>
                        <th>Consent</th>
                        <th>Recommendations</th>
                        <th>Last Activity</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in users %}
                    <tr>
                        <td><code>{{ item.user.user_id }}</code></td>
                        <td>{{ item.user.name or "N/A" }}</td>
                        <td>{{ item.user.email or "N/A" }}</td>
                        <td>
                            {% if item.current_persona %}
                                <span class="badge badge-persona">{{ item.current_persona }}</span>
                            {% else %}
                                <span class="badge badge-none">None</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if item.user.consent_status %}
                                <span class="badge badge-success">Consented</span>
                            {% else %}
                                <span class="badge badge-error">Not Consented</span>
                            {% endif %}
                        </td>
                        <td>{{ item.recommendation_count }}</td>
                        <td>
                            {% if item.last_activity %}
                                {{ item.last_activity.strftime('%Y-%m-%d %H:%M') }}
                            {% else %}
                                Never
                            {% endif %}
                        </td>
                        <td>
                            <a href="/users/{{ item.user.user_id }}" class="btn btn-small btn-primary">View</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="8" class="empty-state">No users found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
</div>
{% endblock %}

